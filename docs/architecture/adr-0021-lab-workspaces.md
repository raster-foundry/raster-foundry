# Lab analysis workflow

## Context
Our lab interface has been through several iterations

### Initial implementation
Initially, we started with just Tools.
We added ToolRuns once we realized that we needed a way to create copies of tools to adjust
the sources we use.
The basic workflow:
* Browse existing tools, which are manually created through api requests
* Create a tool run from the tool
* Edits to the tool run generate a new tool run. Tool runs are effectively like exports

### Current implementation
On the backend and frontend, we now have first class support for MAML, which is a method of 
translating mathematical expressions into ASTs (tools)
Workflow:
* Browse tools (now called templates)
* Create a tool run from a template (now called analyses)
* Modify the tool run instead of generating new tools runs every time
* Analysis results can be referenced by a url, which acts as basemap calculated on the fly

### Required features
* Easy way to share both analysis results and templates for others to use
* Ability to interactively create analyses
* Ability to preview / share the map generated by any node

## Proposed solution
After some discussion with Nathan and Eugene, I've concluded that a workflow centered on workspaces,
rather than singular analyses makes the most sense, because the design tradeoffs for supporting multiple AST's at the same level that we support exports and sharing aren't worth it.
Workflow:
* User creates new workspace
* User either builds a new analysis from scratch in the workspace, or imports a template to create one
* User previews nodes to verify that things are as they should be. User can share preview links, 
  but they will update as the analysis is modified and may not always be completely valid.
* User publishes an analysis from the workspace to a new Template.
  This template version is immutable, and can be relied upon not to change. Production usage
  of basemaps / imagery should be published as a template because they require explicit exports
  in order to update. 
* User makes changes to an analysis, and publishes a new version to the same Template. 
  Users can view tagged versions of the template at will.
* User can clone a workspace, which copies all analyses to a new workspace but does not link them otherwise
* Templates can be published with various visibility permissions, 
  and future versions of MAML will allow referencing them directly as nodes.
  This opens up the possibility of black box algorithms, 

### User interations

#### Workspaces
* User point of entry for creating analysis workflows
* User searches by workspace, not by analysis
* Contain multiple analyses
* Allow specifying a default analysis for rendering / sharing
* Import and export templates
* Create a new analysis from a node, or add a node to an existing analysis
* Compare outputs of analyses
* Migration should create a new workspace for every existing analysis

#### Analyses
* Individual AST's
* Modified in place, changes effective immediately
* Not required to be named anymore, but can be linked to a template for easier exports
* In the future, will be able to reference templates or other analyses using a ToolReferenceNode (probably renamed)
* Add readonly attrubute to prevent exported analyses from being edited

#### Templates
* List of immutable AST exports with metadata for versioning / searching

### Models:

#### Templates
* UUID id  
* String name  
* String details  
* String description  
* String thumbnailUrl  
* UUID[User] owner  
* UUID[User] createdBy  
* UUID[User] modifiedBy  
* Date createdAt  
* Date modifiedAt  
* UUID[Organization] organization  
* Visiblity visiblity  
* String requirements  
* UUID[license] license  

#### TemplateCategory
* Template
* Category
  
#### TemplateTag
* UUID[Template] template
* UUID[Tag] tag

#### TemplateVersion
* Int: id - auto increment so it's easy to sort by  
* String version  
* UUID[Template] template  
* UUID[Analysis] analysis  
* Date createdAt  
* Date modifiedAt  
* UUID[User] createdBy  
* UUID[User] modifiedBy  

#### Workspace
* UUID id  
* String name  
* String description  
* UUID[Analysis] activeAnalysis  
  
#### WorkspaceCategory
* UUID[Workspace] workspace  
* UUID[Category] category  

#### WorkspaceTag
* UUID[Workspace] workspace  
* UUID[Tag] tag  

#### WorkspaceAnalysis
* UUID[Workspace] workspace  
* UUID[Analysis] analysis  
* Date createdAt  
* Date modifiedAt  
* UUID[User] createdBy  
* UUID[User] modifiedBy  
  
