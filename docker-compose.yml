version: '2'
services:
  # Database
  postgres:
    image: quay.io/azavea/postgis:9.4.4
    env_file: .env
    ports:
      - "5432:5432"

  app-server:
    image: quay.io/azavea/scala:2.11.8
    links:
      - postgres:database.raster-foundry.internal
    env_file: .env
    ports:
      - "9000:9000"
    volumes:
      - ./app-server/:/opt/raster-foundry/app-server/
      - ./.ivy2:/root/.ivy2
      - ./.sbt:/root/.sbt
    working_dir: /opt/raster-foundry/app-server/
    command: ./sbt run

  app-tasks-decider:
    image: rf-app-tasks
    build:
      context: ./app-tasks
      dockerfile: Dockerfile
    working_dir: /opt/raster-foundry/app-tasks/src/
    environment:
      - AWS_SWF_DOMAIN
      - AWS_PROFILE
    volumes:
      - ./app-tasks/:/opt/raster-foundry/app-tasks/
      - $HOME/.aws:/root/.aws:ro
    command: python -m rf decider

  app-tasks-worker:
    image: rf-app-tasks
    build:
      context: ./app-tasks
      dockerfile: Dockerfile
    working_dir: /opt/raster-foundry/app-tasks/src/
    environment:
      - AWS_SWF_DOMAIN
      - AWS_PROFILE      
    volumes:
      - ./app-tasks/:/opt/raster-foundry/app-tasks/
      - $HOME/.aws:/root/.aws:ro
    command: python -m rf worker

  swagger-editor:
    image: swaggerapi/swagger-editor:latest
    ports:
      - "8080:8080"
